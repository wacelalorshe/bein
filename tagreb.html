بالطبع، يمكننا تعديل الكود ليظهر رسالة التثبيت فقط في حال عدم تحديد خيار "عدم العرض مرة أخرى" أو عند الضغط على "موافق". إذا ضغط المستخدم على "إلغاء"، سيتم تخزين هذا الاختيار في `localStorage` بحيث لا تظهر الرسالة مرة أخرى.

### الكود المعدل:

```html
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فتح رابط في تطبيق</title>

    <style type="text/css">
        .grid1-container {
            display: grid;
            justify-content: center;
            grid-template-columns: repeat(1, 1fr);
            grid-gap: 10px;
            color: green;
            padding: 20px;
        }

        button {
            background-image: linear-gradient(to right, #151825, #3A4266);
            padding: 15px;
            margin: 20px 10px;
            height: 100px;
            width: 200px;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }

        /* ستايل النافذة المنبثقة */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none; /* مخفية بشكل افتراضي */
        }
    </style>

    <script>
        function openApp(appUrl, downloadUrl) {
            // محاولة فتح التطبيق
            window.location.href = appUrl;

            // الانتظار قليلاً لمعرفة ما إذا تم فتح التطبيق
            setTimeout(function() {
                // تحقق من حالة عدم العرض مرة أخرى
                if (localStorage.getItem('doNotShowAgain') !== 'true') {
                    // إظهار النافذة المنبثقة
                    document.getElementById('popup').style.display = 'block';
                }
            }, 3000); // الانتظار لمدة 3 ثوان
        }

        function confirmAction(downloadUrl) {
            // فتح رابط التحميل
            window.open(downloadUrl, '_blank');
            // إغلاق النافذة المنبثقة
            document.getElementById('popup').style.display = 'none';
        }

        function handleCheckbox() {
            const checkbox = document.getElementById('doNotShowAgainCheckbox');
            if (checkbox.checked) {
                localStorage.setItem('doNotShowAgain', 'true');
            }
        }

        function cancelAction() {
            // إذا ضغط المستخدم على "إلغاء"، يتم تخزين ذلك
            localStorage.setItem('doNotShowAgain', 'true');
            // إغلاق النافذة المنبثقة
            document.getElementById('popup').style.display = 'none';
        }
    </script>
</head>
<body>

<header>
    <div class="grid1-container">
        <div align="center">
            <button onclick="openApp('xmtv://WwoiaHR0cHM6Ly9saXZlYWtnci5hbGthc3NkaWdpdGFsLm5ldC9obHMvbGl2ZS8yMDk3MDM3L0Fsa2FzczR4aXV5dGdmZmljY24vbWFzdGVyLm0zdTh8Y2FzdD1mYWxzZXxuYW1lPS4ud2FjZWwgdHYuLiIKCl0K ,  https://play.google.com/store/apps/details?id=com.xpola.player')">
                <h2>الكـاس 1</h2>
            </button>

            <button onclick="openApp('yourapp://link2', 'https://link-to-download-app.com')">
                <h2>الكـاس 2</h2>
            </button>
        </div>
    </div>
</header>

<!-- النافذة المنبثقة -->
<div id="popup" class="popup">
    <p>يجب أولاً تثبيت التطبيق. هل ترغب في الذهاب إلى رابط التحميل؟</p>
    <label>
        <input type="checkbox" id="doNotShowAgainCheckbox" onclick="handleCheckbox()"> عدم العرض مرة أخرى
    </label>
    <br><br>
    <button onclick="confirmAction('https://link-to-download-app.com')">موافق</button>
    <button onclick="cancelAction()">إلغاء</button>
</div>

</body>
</html>
```

### التغييرات الأساسية:
1. **إضافة دالة `cancelAction`**: هذه الدالة تقوم بتخزين القيمة `'true'` في `localStorage` عندما يضغط المستخدم على "إلغاء"، مما يعني أنه لن يتم عرض الرسالة مرة أخرى.
2. **التحقق من خانة الاختيار**: إذا اختار المستخدم "عدم العرض مرة أخرى" ثم ضغط على "موافق"، يتم أيضًا تخزين هذا الاختيار في `localStorage`.

### ملاحظات:
- تأكد من استبدال `'yourapp://link1'` و`'yourapp://link2'` و`'https://link-to-download-app.com'` بالقيم الصحيحة الخاصة بتطبيقك.
- تأكد من اختبار الكود على متصفح يدعم فتح التطبيقات، ويفضل أن يكون على جهاز محمول.
